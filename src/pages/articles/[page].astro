---
import { all_articles } from '@api';
import { getEntry, getEntries } from 'astro:content';
import type { GetStaticPaths } from 'astro';
import PostListLayout from '@pages/_layouts/PostListLayout.astro';

export const prerender = true;

export const getStaticPaths = (({ paginate }) => {
  return paginate(all_articles, { pageSize: 5 });
}) satisfies GetStaticPaths;

const { page } = Astro.props;
const posts = await Promise.all(
  page.data.map(async (article) => {
    return {
      author: await getEntry(article.data.authored_by),
      tags: await getEntries(article.data.tags),
      publishedAt: article.data.published_at,
      description: article.data.description,
      heading: article.data.heading,
      slug: article.slug,
      collection: article.collection
    };
  })
);
---

<PostListLayout
  title="Articles"
  description="A collection of articles"
  baseUrl="/articles"
  page={{
    total_pages_count: page.lastPage,
    next_url: page.url.next,
    prev_url: page.url.prev,
    current_page_num: page.currentPage
  }}
  posts={posts}
/>
